---
#
# Emacs installer & config
#
# References
# http://www.plusastra.com/2012/11/installing-emacs-24-on-debian-wheezy.html
# http://www.emacswiki.org/emacs-es/EmacsSnapshotAndDebian
#

#
# Add org-mode pdf export support (942MB of disk space required!)
# Find a lighter alternative.
#  - texlive-latex-base, texlive-latex-recommended, texlive-latex-extra
#

- name: Install git
  apt: pkg=git-core

- name: Install emacs
  apt: name=emacs24

- name: Install cask
  git: repo=https://github.com/cask/cask.git dest=/home/map7/.cask

- name: Set permissions
  file: path=/home/map7/.cask owner=map7 group=map7

- name: Add cask bin PATH to Bash profile
  lineinfile:
    dest=/etc/profile
    regexp=".cask\/bin"
    line='export PATH="/home/map7/.cask/bin:$PATH"'
    state=present    

- name: Copy my setup across
  git: repo=https://github.com/map7/emacs-config.git dest=/home/map7/.emacs.d update=no

- name: Compile my plugins
  command: /home/map7/.cask/bin/cask chdir=/home/map7/.emacs.d

- name: Set permissions
  file: path=/home/map7/.emacs.d owner=map7 group=map7 recurse=yes state=directory

# OLD Way


# - name: Install emacs graphics libraries
#   action: apt pkg={{ item }} state=installed

- name: Run the equivalent of "apt-get update" as a separate step
  apt:
    update_cache: yes

- name: Install Emacs dependencies
  apt:
    pkg: "{{ item }}"
    state: present
    default_release: testing
  with_items:
    - libxaw7-dev
    - libxpm-dev
    - libpng-dev
    - libtiff5-dev
    - libgif-dev
    - libjpeg-dev
    - libgtk2.0-dev
    - libncurses5-dev
    - libdbus-1-dev
    - libxft-dev

# - name: Install requirements for emacs widgets to work
#   apt:
#     pkg: "{{ item }}"
#     state: present
#   with_items:
#     - libwebkitgtk-3.0-0
#     - libwebkitgtk-3.0-dev

# - name: Download latest stable release 24.3 from March 2013
#   command: wget http://gnu.mirror.uber.com.au/emacs/emacs-24.3.tar.gz chdir=/tmp creates=/usr/local/bin/emacs

# - name: Untar image
#   shell: tar xvf emacs-24.3.tar.gz chdir=/tmp creates=/usr/local/bin/emacs

# - name: Generate emacs config
#   action: command ./autogen.sh chdir=/tmp/emacs-24.3 creates=/tmp/emacs-24.3/configure

# - name: Run emacs configure
#   action: command ./configure --prefix=/opt/emacs24 chdir=/tmp/emacs-24.3 creates=/usr/local/bin/emacs

# - name: Compile emacs24
#   command: make -j $ansible_processor_cores chdir=/tmp/emacs-24.3 creates=/usr/local/bin/emacs

# - name: Install emacs24
#   command: make install chdir=/tmp/emacs-24.3 creates=/usr/local/bin/emacs

# - name: Link emacs24
#   command: ln -s /opt/emacs24/bin/emacs /usr/local/bin/emacs creates=/usr/local/bin/emacs

# - name: Install window control
#   apt: pkg=wmctrl state=present
